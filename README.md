# Pull Request's Service

```sh
git clone https://github.com/VladLenkovskiy/PullRequestService.git
```
## Команды

# pr-service

| Команда         | Описание                                           |
|-----------------|----------------------------------------------------|
| `make docker-compose-up`      | Запуск сервиса                       |
| `make docker-down`     | Остановка контейнеров                   |
| `make test-integration`     | Интеграционное тестирование |
| `make test-e2e`     | E2E-тестирование                           |
| `make test-load`     | Нагрузочное тестирование                               |
| `make lint` | golangci-lint                  |

## Заметки по реализации и ошибкам

 - Использованы методы и сканирование sqlx; для одиночных записей применён SelectContext вместо GetContext. При неправильном сканировании возникала ошибка "scannable dest type ptr with >1 columns"
 - Обеспечена идемпотентность тестов: при первом выполнении работали успешно, а для устойчивости к падению добавлен рандом в айдишники
 - Миграции не запускались из-за конфликтов в именах файлов. Необходимо добавлять суффиксы с буквами/цифрами к имени миграции.
 - Проблема миграций через Docker: иногда файл .env не попадал в контейнер, при этом локально всё работало корректно. Исправлено через изменение пайплайна и вручную.

## Дополнительные задания

 - `GET /stats`
 - `POST /deactivate`


### Нагрузочное тестирование


### LOAD TEST SUMMARY

Duration: 10s
Total requests: 150


| Type                | create_pr              | create_team            | get_team                 |
|---------------------|-----------------------|------------------------|--------------------------|
| Requests            | 50                    | 50                     | 50                       |
| Success             | 50                    | 50                     | 50                       |
| Failed              | 0                     | 0                      | 0                        |
| Real RPS            | 5.00                  | 5.00                   | 5.00                     |
| Avg lat             | 8.55438ms             | 4.308612ms             | 3.739502ms               |
| Max lat             | 21.853ms              | 13.9437ms              | 12.7982ms                |
| Status codes        | 201: 50               | 201: 50                | 200: 50                  |

### OVERALL

| Total | Success | Failed | Real RPS | Avg latency | Max latency |
|-------|---------|--------|----------|-------------|-------------|
| 150   | 150     | 0      | 15.00    | 5.534164ms  | 21.853ms    |