# Pull Request's Service

```sh
git clone https://github.com/VladLenkovskiy/PullRequestService.git
```
## Команды

# pr-service

| Команда         | Описание                                           |
|-----------------|----------------------------------------------------|
| `make docker-compose-up`      | Запуск сервиса                       |
| `make docker-down`     | Остановка контейнеров                   |
| `make test-integration`     | Интеграционное тестирование |
| `make test-e2e`     | E2E-тестирование                           |
| `make test-load`     | Нагрузочное тестирование                               |
| `make lint` | golangci-lint                  |

## Заметки по реализации и ошибкам

 - Была ошибка "scannable dest type ptr with >1 columns" при неправильном сканировании. Для решения использован SelectContext вместо GetContext для одиночных записей; Использовал базовую библиотеку sql, но потом переделал на более удобную sqlX.
 - При первом запуске тесты проходили, а при последующих падали из-за того что такие айдишники(id_pull_request, user_id) уже были созданы. Из решений - генерирую каждый раз новый ID 
 - Не накатывались миграции через контейнер migration. Была ошибка в названиях файлов, нужно было обязательно иметь префикс .up.sql
 - Файл .env не попадал в контейнер, при этом локально всё работало корректно. Исправлено через изменение версии docker compose.
 - Некорректно сделал метод отдачи статистики, т.к. отдаю все данные которых может быть много. Нужно отдавать постранично, но реализовать и разобраться не успел .

## Дополнительные задания

 - `GET /stats`
 - `POST /deactivate`


### Нагрузочное тестирование


### LOAD TEST SUMMARY

Duration: 10s
Total requests: 150


| Type                | create_pr              | create_team            | get_team                 |
|---------------------|-----------------------|------------------------|--------------------------|
| Requests            | 50                    | 50                     | 50                       |
| Success             | 50                    | 50                     | 50                       |
| Failed              | 0                     | 0                      | 0                        |
| Real RPS            | 5.00                  | 5.00                   | 5.00                     |
| Avg lat             | 8.55438ms             | 4.308612ms             | 3.739502ms               |
| Max lat             | 21.853ms              | 13.9437ms              | 12.7982ms                |
| Status codes        | 201: 50               | 201: 50                | 200: 50                  |

### OVERALL

| Total | Success | Failed | Real RPS | Avg latency | Max latency |
|-------|---------|--------|----------|-------------|-------------|
| 150   | 150     | 0      | 15.00    | 5.534164ms  | 21.853ms    |